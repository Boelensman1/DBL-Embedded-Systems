<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=None">
  <style type="text/css">
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }
body .hll { background-color: #ffffcc }
body  { background: #f8f8f8; }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="background-color: #f0f0f0; padding: 0 5px 0 5px">  1</span> <span style="color: #666666">&lt;?</span>php
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">  2</span> <span style="color: #408080; font-style: italic">/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">  3</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">  4</span> <span style="color: #BA2121; font-style: italic">/**</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">  5</span> <span style="color: #BA2121; font-style: italic"> * Sort of a simulation of the PP2 program controlling the Fischer Technik in order to sort black and white discs.</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">  6</span> <span style="color: #BA2121; font-style: italic"> * @team Group 16</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">  7</span> <span style="color: #BA2121; font-style: italic"> * @author Stefan van den Berg</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">  8</span> <span style="color: #BA2121; font-style: italic"> * @author Rolf Verschuuren</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">  9</span> <span style="color: #BA2121; font-style: italic"> * @author Wigger Boelens</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 10</span> <span style="color: #BA2121; font-style: italic"> * @since 13/3/2015</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 11</span> <span style="color: #BA2121; font-style: italic"> */</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 12</span> <span style="color: #008000; font-weight: bold">include</span> <span style="color: #BA2121">&#39;functions.php&#39;</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 13</span> <span style="color: #408080; font-style: italic">//**COMPILER**</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 14</span> moveFunction(<span style="color: #BA2121">&#39;timerInterrupt&#39;</span>, <span style="color: #666666">1</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 15</span> moveFunction(<span style="color: #BA2121">&#39;timerManage&#39;</span>, <span style="color: #666666">50</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 16</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 17</span> <span style="color: #408080; font-style: italic">//**DATA**</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 18</span> initVar(<span style="color: #BA2121">&#39;offset&#39;</span>, <span style="color: #666666">1</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 19</span> initVar(<span style="color: #BA2121">&#39;stackPointer&#39;</span>, <span style="color: #666666">1</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 20</span> initVar(<span style="color: #BA2121">&#39;outputs&#39;</span>, <span style="color: #666666">12</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 21</span> initVar(<span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">1</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 22</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 23</span> <span style="color: #408080; font-style: italic">//**CODE**</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 24</span> <span style="color: #008000">define</span>(<span style="color: #BA2121">&#39;TIMEMOTORDOWN&#39;</span>, <span style="color: #666666">150</span>); <span style="color: #408080; font-style: italic">//how long the sorter takes to move down</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 25</span> <span style="color: #008000">define</span>(<span style="color: #BA2121">&#39;BELT&#39;</span>, <span style="color: #666666">2000</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 26</span> <span style="color: #008000">define</span>(<span style="color: #BA2121">&#39;BELTROUND&#39;</span>, <span style="color: #666666">2000</span>);<span style="color: #408080; font-style: italic">//Time for the belt to make a rotation</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 27</span> <span style="color: #008000">define</span>(<span style="color: #BA2121">&#39;SORT&#39;</span>, <span style="color: #666666">200</span>);<span style="color: #408080; font-style: italic">//Clockticks to make a rotation</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 28</span> <span style="color: #008000">define</span>(<span style="color: #BA2121">&#39;COUNTDOWN&#39;</span>, <span style="color: #666666">30000</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 29</span> <span style="color: #408080; font-style: italic">//outputs</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 30</span> <span style="color: #008000">define</span>(<span style="color: #BA2121">&#39;LENSLAMPPOSITION&#39;</span>, <span style="color: #666666">2</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 31</span> <span style="color: #008000">define</span>(<span style="color: #BA2121">&#39;LENSLAMPSORTER&#39;</span>, <span style="color: #666666">6</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 32</span> <span style="color: #008000">define</span>(<span style="color: #BA2121">&#39;HBRIDGE0&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 33</span> <span style="color: #008000">define</span>(<span style="color: #BA2121">&#39;HBRIDGE1&#39;</span>, <span style="color: #666666">1</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 34</span> <span style="color: #008000">define</span>(<span style="color: #BA2121">&#39;CONVEYORBELT&#39;</span>, <span style="color: #666666">7</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 35</span> <span style="color: #008000">define</span>(<span style="color: #BA2121">&#39;FEEDERENGINE&#39;</span>, <span style="color: #666666">3</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 36</span> <span style="color: #008000">define</span>(<span style="color: #BA2121">&#39;DISPLAY&#39;</span>, <span style="color: #666666">8</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 37</span> <span style="color: #008000">define</span>(<span style="color: #BA2121">&#39;LEDSTATEINDICATOR&#39;</span>, <span style="color: #666666">9</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 38</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 39</span> <span style="color: #408080; font-style: italic">//not a state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 40</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">main</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 41</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 42</span>     <span style="color: #008000; font-weight: bold">global</span> <span style="color: #19177C">$counter</span>, <span style="color: #19177C">$location</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 43</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 44</span>     <span style="color: #408080; font-style: italic">//store the offset of the program, this is used in the interrupt</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 45</span>     storeData(R5, <span style="color: #BA2121">&#39;offset&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 46</span>     <span style="color: #408080; font-style: italic">//install the countdown</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 47</span>     installCountdown(<span style="color: #BA2121">&#39;timerInterrupt&#39;</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 48</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 49</span>     <span style="color: #408080; font-style: italic">//save the location of the stackPointer, so we can clear the stack</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 50</span>     storeData(SP, <span style="color: #BA2121">&#39;stackPointer&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 51</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 52</span>     <span style="color: #408080; font-style: italic">//the variables that are the same throughout the program:</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 53</span>     <span style="color: #19177C">$counter</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 54</span>     <span style="color: #19177C">$location</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 55</span>     <span style="color: #19177C">$sleep</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 56</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 57</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 58</span>     <span style="color: #408080; font-style: italic">//stop everything</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 59</span>     <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 60</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE1);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 61</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, LENSLAMPPOSITION);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 62</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, LENSLAMPSORTER);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 63</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, LEDSTATEINDICATOR);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 64</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, DISPLAY);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 65</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, CONVEYORBELT);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 66</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, FEEDERENGINE);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 67</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 68</span>     <span style="color: #408080; font-style: italic">//sh0w the state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 69</span>     <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 70</span>     storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 71</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 72</span>     <span style="color: #408080; font-style: italic">//set HBridge so the sorter starts moving up</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 73</span>     <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">10</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 74</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE0);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 75</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>, <span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 76</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 77</span>     <span style="color: #408080; font-style: italic">//go to the first state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 78</span>     initial();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 79</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 80</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 81</span> <span style="color: #408080; font-style: italic">//state 0</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 82</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">initial</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 83</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 84</span>     <span style="color: #008000; font-weight: bold">global</span> <span style="color: #19177C">$sleep</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 85</span>     <span style="color: #408080; font-style: italic">//disable the lights on the right hand side</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 86</span>     <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 87</span>     display(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;leds2&#39;</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 88</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 89</span>     <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> getData(<span style="color: #BA2121">&#39;stackPointer&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 90</span>     setStackPointer(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 91</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 92</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 93</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 94</span>     <span style="color: #408080; font-style: italic">//check if the sorter push button is pressed</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 95</span>     <span style="color: #19177C">$push</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">5</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 96</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$push</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 97</span>         <span style="color: #408080; font-style: italic">//move sorter down</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 98</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px"> 99</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE0);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">100</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">10</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">101</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE1);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">102</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">103</span>         <span style="color: #408080; font-style: italic">//update state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">104</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">105</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">106</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">107</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">108</span>         <span style="color: #408080; font-style: italic">//reset sleep for the next function</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">109</span>         <span style="color: #19177C">$sleep</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">110</span>         calibrateSorter();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">111</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">112</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">113</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$push</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">114</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">115</span>     <span style="color: #408080; font-style: italic">//loop</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">116</span>     initial();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">117</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">118</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">119</span> <span style="color: #408080; font-style: italic">//state 1</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">120</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">calibrateSorter</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">121</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">122</span>     <span style="color: #008000; font-weight: bold">global</span> <span style="color: #19177C">$sleep</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">123</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">124</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">125</span>     <span style="color: #408080; font-style: italic">//the sorter is now moving down,</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">126</span>     <span style="color: #408080; font-style: italic">//we&#39;re waiting for it to reach its bottom position</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">127</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$sleep</span> <span style="color: #666666">==</span> TIMEMOTORDOWN) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">128</span>         <span style="color: #408080; font-style: italic">//stop the sorter</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">129</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">130</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE1);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">131</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">132</span>         <span style="color: #408080; font-style: italic">//update the state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">133</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">2</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">134</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">135</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">136</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">137</span>         <span style="color: #408080; font-style: italic">//reset sleep for the next state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">138</span>         <span style="color: #19177C">$sleep</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">139</span>         resting();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">140</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">141</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">142</span>     <span style="color: #408080; font-style: italic">//loop</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">143</span>     <span style="color: #19177C">$sleep</span><span style="color: #666666">++</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">144</span>     calibrateSorter();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">145</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">146</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">147</span> <span style="color: #408080; font-style: italic">//state 2</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">148</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">resting</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">149</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">150</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">151</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">152</span>     <span style="color: #408080; font-style: italic">//the program is now waiting for the user to press start/stop</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">153</span>     <span style="color: #19177C">$startStop</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">154</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$startStop</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">155</span>         <span style="color: #408080; font-style: italic">//sleep so we don&#39;t go to pause immediately</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">156</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">157</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">158</span>         <span style="color: #408080; font-style: italic">//power up the lamps</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">159</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">12</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">160</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, LENSLAMPPOSITION);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">161</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">162</span>         timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">163</span>         <span style="color: #008000">sleep</span>(<span style="color: #666666">1000</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">164</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">12</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">165</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, LENSLAMPSORTER);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">166</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">167</span>         timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">168</span>         <span style="color: #008000">sleep</span>(<span style="color: #666666">2000</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">169</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">170</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">171</span>         <span style="color: #408080; font-style: italic">//start up the belt and feeder</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">172</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">9</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">173</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, CONVEYORBELT);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">174</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">9</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">175</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, FEEDERENGINE);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">176</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">177</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">178</span>         <span style="color: #408080; font-style: italic">//set and start the countdown for the moment there are no more disks</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">179</span>         <span style="color: #408080; font-style: italic">//this countdown will reset every time a disk is found</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">180</span>         <span style="color: #408080; font-style: italic">//when it triggers, timerInterrupt will be ran.</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">181</span>         setCountdown(COUNTDOWN);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">182</span>         startCountdown();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">183</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">184</span>         <span style="color: #408080; font-style: italic">//update the state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">185</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">3</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">186</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">187</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">188</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">189</span>         running();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">190</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">191</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$startStop</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">192</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">193</span>     <span style="color: #408080; font-style: italic">//loop</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">194</span>     resting();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">195</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">196</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">197</span> <span style="color: #408080; font-style: italic">//state 3</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">198</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">running</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">199</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">200</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">201</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">202</span>     <span style="color: #408080; font-style: italic">//check if we need to pause</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">203</span>     <span style="color: #19177C">$startStop</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">204</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$startStop</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">205</span>         <span style="color: #408080; font-style: italic">//stop the feeder engine</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">206</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">207</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, FEEDERENGINE);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">208</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">209</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">210</span>         <span style="color: #408080; font-style: italic">//exit after 1 rotation of the belt</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">211</span>         setCountdown(BELT <span style="color: #666666">*</span> <span style="color: #666666">10</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">212</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">213</span>         <span style="color: #408080; font-style: italic">//update the state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">214</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">9</span>;<span style="color: #408080; font-style: italic">//TODO: echte state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">215</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">216</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">217</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">218</span>         runningTimer();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">219</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">220</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">221</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$startStop</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">222</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">223</span>     <span style="color: #408080; font-style: italic">//check if a disk is at the position detector</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">224</span>     <span style="color: #19177C">$position</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">7</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">225</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$position</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">226</span>         <span style="color: #408080; font-style: italic">//reset the countdown, because a disk was just detected</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">227</span>         setCountdown(COUNTDOWN);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">228</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">229</span>         <span style="color: #408080; font-style: italic">//update the state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">230</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">4</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">231</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">232</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">233</span>         runningWait();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">234</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">235</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$position</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">236</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">237</span>     <span style="color: #408080; font-style: italic">//loop</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">238</span>     running();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">239</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">240</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">241</span> <span style="color: #408080; font-style: italic">//state 4</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">242</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">runningWait</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">243</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">244</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">245</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">246</span>     <span style="color: #408080; font-style: italic">//check if we need to pause</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">247</span>     <span style="color: #19177C">$startStop</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">248</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$startStop</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">249</span>         <span style="color: #408080; font-style: italic">//stop the feeder engine</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">250</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">251</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, FEEDERENGINE);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">252</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">253</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">254</span>         <span style="color: #408080; font-style: italic">//exit after 1 rotation of the belt</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">255</span>         setCountdown(BELT <span style="color: #666666">*</span> <span style="color: #666666">10</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">256</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">257</span>         <span style="color: #408080; font-style: italic">//update the state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">258</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">9</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">259</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">260</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">261</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">262</span>         runningTimer();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">263</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">264</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">265</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$startStop</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">266</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">267</span>     <span style="color: #408080; font-style: italic">//check if a disk is at the position detector</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">268</span>     <span style="color: #19177C">$position</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">7</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">269</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$position</span> <span style="color: #666666">==</span> <span style="color: #666666">0</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">270</span>         <span style="color: #408080; font-style: italic">//reset the countdown, because a disk was just detected</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">271</span>         setCountdown(COUNTDOWN);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">272</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">273</span>         <span style="color: #408080; font-style: italic">//update state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">274</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">5</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">275</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">276</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">277</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">278</span>         runningTimerReset();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">279</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">280</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">281</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$position</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">282</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">283</span>     <span style="color: #408080; font-style: italic">//check if a white disk is at the colour detector</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">284</span>     <span style="color: #19177C">$colour</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">6</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">285</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$colour</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">286</span>         <span style="color: #408080; font-style: italic">//move the sorter up so the disk goes to the correct box</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">287</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">10</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">288</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE0);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">289</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">290</span>         <span style="color: #408080; font-style: italic">//stop the feeder engine</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">291</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">292</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, FEEDERENGINE);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">293</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">294</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">295</span>         <span style="color: #408080; font-style: italic">//update state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">296</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">6</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">297</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">298</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">299</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">300</span>         motorUp();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">301</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">302</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$colour</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">303</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">304</span>     <span style="color: #408080; font-style: italic">//loop</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">305</span>     runningWait();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">306</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">307</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">308</span> <span style="color: #408080; font-style: italic">//state 5</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">309</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">runningTimerReset</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">310</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">311</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">312</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">313</span>     <span style="color: #408080; font-style: italic">//update state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">314</span>     <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">4</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">315</span>     storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">316</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">317</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">318</span>     runningWait();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">319</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">320</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">321</span> <span style="color: #408080; font-style: italic">//state 6</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">322</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">motorUp</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">323</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">324</span>     <span style="color: #008000; font-weight: bold">global</span> <span style="color: #19177C">$sleep</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">325</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">326</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">327</span>     <span style="color: #408080; font-style: italic">//check if we need to pause</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">328</span>     <span style="color: #19177C">$startStop</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">329</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$startStop</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">330</span>         <span style="color: #408080; font-style: italic">//stop the feeder engine</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">331</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">332</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, FEEDERENGINE);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">333</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">334</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">335</span>         <span style="color: #408080; font-style: italic">//exit after 1 rotation of the belt</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">336</span>         setCountdown(BELT <span style="color: #666666">*</span> <span style="color: #666666">10</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">337</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">338</span>         <span style="color: #408080; font-style: italic">//update the state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">339</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">10</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">340</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">341</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">342</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">343</span>         motorUpTimer();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">344</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">345</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">346</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$startStop</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">347</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">348</span>     <span style="color: #408080; font-style: italic">//check if the sorter push button is pressed</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">349</span>     <span style="color: #19177C">$push</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">5</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">350</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$push</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">351</span>         <span style="color: #408080; font-style: italic">//stop the sorter engine, because its at its highest position</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">352</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">353</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE0);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">354</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">355</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">356</span>         <span style="color: #408080; font-style: italic">//update state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">357</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">7</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">358</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">359</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">360</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">361</span>         <span style="color: #408080; font-style: italic">//set sleep for the next function</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">362</span>         <span style="color: #19177C">$sleep</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">363</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">364</span>         whiteWait();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">365</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">366</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$push</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">367</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">368</span>     <span style="color: #408080; font-style: italic">//loop</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">369</span>     motorUp();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">370</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">371</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">372</span> <span style="color: #408080; font-style: italic">//state 7</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">373</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">whiteWait</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">374</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">375</span>     <span style="color: #008000; font-weight: bold">global</span> <span style="color: #19177C">$sleep</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">376</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">377</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">378</span>     <span style="color: #408080; font-style: italic">//we are waiting for the white disk to be sorted</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">379</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$sleep</span> <span style="color: #666666">==</span> SORT) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">380</span>         <span style="color: #408080; font-style: italic">//start moving the sorter down</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">381</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">10</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">382</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE1);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">383</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">384</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">385</span>         <span style="color: #408080; font-style: italic">//make sure the timerinterrupt is correct</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">386</span>         setCountdown(COUNTDOWN);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">387</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">388</span>         <span style="color: #408080; font-style: italic">//update state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">389</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">8</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">390</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">391</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">392</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">393</span>         <span style="color: #408080; font-style: italic">//reset sleep for the next function</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">394</span>         <span style="color: #19177C">$sleep</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">395</span>         motorDown();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">396</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">397</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">398</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">399</span>     <span style="color: #408080; font-style: italic">//check if we need to pause</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">400</span>     <span style="color: #19177C">$startStop</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">401</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$startStop</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">402</span>         <span style="color: #408080; font-style: italic">//stop the feeder engine</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">403</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">404</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, FEEDERENGINE);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">405</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">406</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">407</span>         <span style="color: #408080; font-style: italic">//exit after 1 rotation of the belt</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">408</span>         setCountdown(BELT <span style="color: #666666">*</span> <span style="color: #666666">10</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">409</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">410</span>         <span style="color: #408080; font-style: italic">//update the state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">411</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">11</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">412</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">413</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">414</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">415</span>         whiteWaitTimer();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">416</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">417</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$startStop</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">418</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">419</span>     <span style="color: #408080; font-style: italic">//loop</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">420</span>     <span style="color: #19177C">$sleep</span><span style="color: #666666">++</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">421</span>     whiteWait();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">422</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">423</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">424</span> <span style="color: #408080; font-style: italic">//state 8</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">425</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">motorDown</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">426</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">427</span>     <span style="color: #008000; font-weight: bold">global</span> <span style="color: #19177C">$sleep</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">428</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">429</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">430</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">431</span>     <span style="color: #408080; font-style: italic">//check if a white disk is at the colour detector</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">432</span>     <span style="color: #19177C">$colour</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">6</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">433</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$colour</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">434</span>         <span style="color: #408080; font-style: italic">//move the sorter up so the disk goes to the correct box</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">435</span>         <span style="color: #19177C">$temp</span><span style="color: #666666">=0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">436</span>         storeData(<span style="color: #19177C">$temp</span>,<span style="color: #BA2121">&#39;outputs&#39;</span>,HBRIDGE1);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">437</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">10</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">438</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE0);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">439</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">440</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">441</span>         <span style="color: #408080; font-style: italic">//update state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">442</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">6</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">443</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">444</span>         <span style="color: #19177C">$sleep</span><span style="color: #666666">=0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">445</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">446</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">447</span>         motorUp();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">448</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">449</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$colour</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">450</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">451</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">452</span>     <span style="color: #408080; font-style: italic">//the sorter is moving down, we are waiting for that to complete</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">453</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$sleep</span> <span style="color: #666666">==</span> TIMEMOTORDOWN) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">454</span>         <span style="color: #408080; font-style: italic">//stop the sorter, its where it should be</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">455</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">456</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE1);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">457</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">7</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">458</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, FEEDERENGINE);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">459</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">460</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">461</span>         <span style="color: #408080; font-style: italic">//update state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">462</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">4</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">463</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">464</span>         <span style="color: #408080; font-style: italic">//reset sleep for the next function</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">465</span>         <span style="color: #19177C">$sleep</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">466</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">467</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">468</span>         runningWait();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">469</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">470</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">471</span>     <span style="color: #408080; font-style: italic">//check if we need to pause</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">472</span>     <span style="color: #19177C">$startStop</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">473</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$startStop</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">474</span>         <span style="color: #408080; font-style: italic">//stop the feeder engine</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">475</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">476</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, FEEDERENGINE);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">477</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">478</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">479</span>         <span style="color: #408080; font-style: italic">//exit after 1 rotation of the belt</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">480</span>         setCountdown(BELT <span style="color: #666666">*</span> <span style="color: #666666">10</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">481</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">482</span>         <span style="color: #408080; font-style: italic">//update the state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">483</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">12</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">484</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">485</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">486</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">487</span>         motorDownTimer();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">488</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">489</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$startStop</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">490</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">491</span>     <span style="color: #408080; font-style: italic">//loop</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">492</span>     <span style="color: #19177C">$sleep</span><span style="color: #666666">++</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">493</span>     motorDown();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">494</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">495</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">496</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">497</span> <span style="color: #408080; font-style: italic">//state 9</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">498</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">runningTimer</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">499</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">500</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">501</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">502</span>     <span style="color: #408080; font-style: italic">//update state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">503</span>     <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">13</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">504</span>     storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">505</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">506</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">507</span>     runningStop();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">508</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">509</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">510</span> <span style="color: #408080; font-style: italic">//state 10</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">511</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">motorUpTimer</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">512</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">513</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">514</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">515</span>     <span style="color: #408080; font-style: italic">//update state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">516</span>     <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">14</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">517</span>     storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">518</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">519</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">520</span>     motorUpStop();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">521</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">522</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">523</span> <span style="color: #408080; font-style: italic">//state 11</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">524</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">whiteWaitTimer</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">525</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">526</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">527</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">528</span>     <span style="color: #408080; font-style: italic">//update state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">529</span>     <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">15</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">530</span>     storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">531</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">532</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">533</span>     whiteWaitStop();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">534</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">535</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">536</span> <span style="color: #408080; font-style: italic">//state 12</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">537</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">motorDownTimer</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">538</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">539</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">540</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">541</span>     <span style="color: #408080; font-style: italic">//update state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">542</span>     <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">16</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">543</span>     storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">544</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">545</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">546</span>     motorDownStop();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">547</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">548</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">549</span> <span style="color: #408080; font-style: italic">//state 13</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">550</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">runningStop</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">551</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">552</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">553</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">554</span>     <span style="color: #408080; font-style: italic">//check if a white disk is at the colour detector</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">555</span>     <span style="color: #19177C">$colour</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">6</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">556</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$colour</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">557</span>         <span style="color: #408080; font-style: italic">//stop the sorter engine, because its at its highest position</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">558</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">10</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">559</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE0);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">560</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">561</span>         <span style="color: #408080; font-style: italic">//stop the feeder engine</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">562</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">563</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, FEEDERENGINE);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">564</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">565</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">566</span>         <span style="color: #408080; font-style: italic">//update state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">567</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">10</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">568</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">569</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">570</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">571</span>         motorUpStop();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">572</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">573</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$colour</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">574</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">575</span>     <span style="color: #408080; font-style: italic">//loop</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">576</span>     runningStop();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">577</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">578</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">579</span> <span style="color: #408080; font-style: italic">//state 14</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">580</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">motorUpStop</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">581</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">582</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">583</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">584</span>     <span style="color: #408080; font-style: italic">//check if the sorter push button is pressed</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">585</span>     <span style="color: #19177C">$push</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">5</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">586</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$push</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">587</span>         <span style="color: #408080; font-style: italic">//stop the engine of the sorter</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">588</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">589</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE0);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">590</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">591</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">592</span>         <span style="color: #408080; font-style: italic">//update state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">593</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">11</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">594</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">595</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">596</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">597</span>         whiteWaitStop();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">598</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">599</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$push</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">600</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">601</span>     <span style="color: #408080; font-style: italic">//loop</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">602</span>     motorUpStop();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">603</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">604</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">605</span> <span style="color: #408080; font-style: italic">//state 15</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">606</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">whiteWaitStop</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">607</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">608</span>     <span style="color: #008000; font-weight: bold">global</span> <span style="color: #19177C">$sleep</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">609</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">610</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">611</span>     <span style="color: #408080; font-style: italic">//check if the white disk has been sorted</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">612</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$sleep</span> <span style="color: #666666">==</span> SORT) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">613</span>         <span style="color: #408080; font-style: italic">//it has, so lets start moving the sorter down</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">614</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">10</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">615</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE1);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">616</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">617</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, FEEDERENGINE);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">618</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">619</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">620</span>         <span style="color: #408080; font-style: italic">//update state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">621</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">12</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">622</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">623</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">624</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">625</span>         <span style="color: #19177C">$sleep</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">626</span>         motorDownStop();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">627</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">628</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">629</span>     <span style="color: #408080; font-style: italic">//loop</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">630</span>     <span style="color: #19177C">$sleep</span><span style="color: #666666">++</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">631</span>     whiteWaitStop();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">632</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">633</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">634</span> <span style="color: #408080; font-style: italic">//state 16</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">635</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">motorDownStop</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">636</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">637</span>     <span style="color: #008000; font-weight: bold">global</span> <span style="color: #19177C">$sleep</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">638</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">639</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">640</span>     <span style="color: #408080; font-style: italic">//check if the sorter has moved down</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">641</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$sleep</span> <span style="color: #666666">==</span> TIMEMOTORDOWN) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">642</span>         <span style="color: #408080; font-style: italic">//it has, so lets stop it</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">643</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">644</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE1);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">645</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">646</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">647</span>         <span style="color: #408080; font-style: italic">//update the state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">648</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">9</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">649</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">650</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">651</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">652</span>         <span style="color: #19177C">$sleep</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">653</span>         runningStop();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">654</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">655</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">656</span>     <span style="color: #408080; font-style: italic">//loop</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">657</span>     <span style="color: #19177C">$sleep</span><span style="color: #666666">++</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">658</span>     motorDownStop();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">659</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">660</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">661</span> <span style="color: #408080; font-style: italic">//not a state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">662</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">timerInterrupt</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">663</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">664</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">665</span>     <span style="color: #408080; font-style: italic">//show that we are in the timer interrupt</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">666</span>     <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">5</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">667</span>     display(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;display&#39;</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">668</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">669</span>     <span style="color: #408080; font-style: italic">//start moving the sorter up, to start the calibration</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">670</span>     <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">10</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">671</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE0);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">672</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">673</span>     <span style="color: #408080; font-style: italic">//stop the rest</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">674</span>     <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">675</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, LENSLAMPPOSITION);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">676</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, LENSLAMPSORTER);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">677</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, LEDSTATEINDICATOR);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">678</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, DISPLAY);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">679</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, CONVEYORBELT);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">680</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, FEEDERENGINE);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">681</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">682</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">683</span>     <span style="color: #408080; font-style: italic">//reset, because we will no longer be in timerInterrupt</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">684</span>     display(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;display&#39;</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">685</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">686</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">687</span>     <span style="color: #408080; font-style: italic">//go back to initial</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">688</span>     <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> getData(<span style="color: #BA2121">&#39;offset&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">689</span>     <span style="color: #19177C">$temp2</span> <span style="color: #666666">=</span> getFuncLocation(<span style="color: #BA2121">&#39;initial&#39;</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">690</span>     <span style="color: #19177C">$temp</span> <span style="color: #666666">+=</span> <span style="color: #19177C">$temp2</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">691</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">692</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">693</span>     addStackPointer(<span style="color: #666666">2</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">694</span>     pushStack(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">695</span>     addStackPointer(<span style="color: #666666">-1</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">696</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">697</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">698</span> <span style="color: #408080; font-style: italic">//not a state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">699</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">abort</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">700</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">701</span>     <span style="color: #408080; font-style: italic">//free some memory</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">702</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$engines</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">703</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">704</span>     <span style="color: #408080; font-style: italic">//prevent timerinterrupt</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">705</span>     setCountdown(<span style="color: #666666">1000</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">706</span>     <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> getData(<span style="color: #BA2121">&#39;stackPointer&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">707</span>     setStackPointer(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">708</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">709</span>     <span style="color: #408080; font-style: italic">//stop everything</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">710</span>     <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">711</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE1);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">712</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE0);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">713</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, LENSLAMPPOSITION);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">714</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, LENSLAMPSORTER);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">715</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, LEDSTATEINDICATOR);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">716</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, DISPLAY);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">717</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, CONVEYORBELT);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">718</span>     storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, FEEDERENGINE);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">719</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">720</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">721</span>     <span style="color: #408080; font-style: italic">//apply the changes to actually stop it</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">722</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">723</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">724</span>     <span style="color: #408080; font-style: italic">//update the state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">725</span>     <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">17</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">726</span>     storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">727</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">728</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">729</span>     <span style="color: #408080; font-style: italic">//show we aborted</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">730</span>     <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">7</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">731</span>     display(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;leds2&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">732</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">733</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">734</span>     aborted();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">735</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">736</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">737</span> <span style="color: #408080; font-style: italic">//state 17</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">738</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">aborted</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">739</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">740</span>     <span style="color: #408080; font-style: italic">//prevent timer interrupt</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">741</span>     setCountdown(<span style="color: #666666">1000</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">742</span>     timerManage();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">743</span>     <span style="color: #408080; font-style: italic">//check if we can start again</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">744</span>     <span style="color: #19177C">$startStop</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">745</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$startStop</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">746</span>         <span style="color: #408080; font-style: italic">//start moving the sorter up, to start the calibration</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">747</span>         <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> <span style="color: #666666">10</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">748</span>         storeData(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;outputs&#39;</span>, HBRIDGE0);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">749</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">750</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">751</span>         <span style="color: #408080; font-style: italic">//update the state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">752</span>         <span style="color: #19177C">$state</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">753</span>         storeData(<span style="color: #19177C">$state</span>, <span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">754</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$state</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">755</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">756</span>         initial();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">757</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">758</span>     <span style="color: #008000">unset</span>(<span style="color: #19177C">$startStop</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">759</span>     aborted();
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">760</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">761</span> }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">762</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">763</span> <span style="color: #408080; font-style: italic">//not a state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">764</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">timerManage</span>()
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">765</span> {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">766</span>     <span style="color: #008000; font-weight: bold">global</span> <span style="color: #19177C">$location</span>, <span style="color: #19177C">$counter</span>, <span style="color: #19177C">$engine</span>, <span style="color: #19177C">$sleep</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">767</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">768</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$location</span> <span style="color: #666666">==</span> <span style="color: #666666">0</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">769</span>         <span style="color: #19177C">$engines</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">770</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">771</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">772</span>     <span style="color: #408080; font-style: italic">//makes sure that when $counter &gt;12 it will reset to 0</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">773</span>     mod(<span style="color: #666666">12</span>, <span style="color: #19177C">$counter</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">774</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">775</span>     <span style="color: #408080; font-style: italic">//get the voltage of output $location</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">776</span>     <span style="color: #19177C">$voltage</span> <span style="color: #666666">=</span> getData(<span style="color: #BA2121">&#39;outputs&#39;</span>, <span style="color: #19177C">$location</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">777</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">778</span>     <span style="color: #408080; font-style: italic">//power up the output when it needs to</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">779</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$voltage</span> <span style="color: #666666">&gt;</span> <span style="color: #19177C">$counter</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">780</span>         <span style="color: #19177C">$voltage</span> <span style="color: #666666">=</span> <span style="color: #19177C">$location</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">781</span>         <span style="color: #19177C">$voltage</span> <span style="color: #666666">=</span> pow(<span style="color: #666666">2</span>, <span style="color: #19177C">$voltage</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">782</span>         <span style="color: #19177C">$engines</span> <span style="color: #666666">+=</span> <span style="color: #19177C">$voltage</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">783</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">784</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">785</span>     <span style="color: #408080; font-style: italic">//check if we did all outputs</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">786</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$location</span> <span style="color: #666666">==</span> <span style="color: #666666">7</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">787</span>         <span style="color: #408080; font-style: italic">//actually output the result</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">788</span>         <span style="color: #008000">sleep</span>(<span style="color: #666666">1</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">789</span>         display(<span style="color: #19177C">$engines</span>, <span style="color: #BA2121">&#39;leds&#39;</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">790</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">791</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">792</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$voltage</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">793</span>         <span style="color: #408080; font-style: italic">//check if abort is pressed</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">794</span>         <span style="color: #19177C">$abort</span> <span style="color: #666666">=</span> getButtonPressed(<span style="color: #666666">1</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">795</span>         <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$abort</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">796</span>             abort();<span style="color: #408080; font-style: italic">//STOP THE MACHINE!</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">797</span>         }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">798</span>         <span style="color: #008000">unset</span>(<span style="color: #19177C">$abort</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">799</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">800</span>         <span style="color: #408080; font-style: italic">//check if we are in a new iteration</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">801</span>         <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$counter</span> <span style="color: #666666">==</span> <span style="color: #666666">6</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">802</span>             <span style="color: #408080; font-style: italic">//set the first part of the display</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">803</span>             <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> getData(<span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">804</span>             mod(<span style="color: #666666">10</span>, <span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">805</span>             display(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;display&#39;</span>, <span style="color: #666666">1</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">806</span>             <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">807</span>         }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">808</span>         <span style="color: #408080; font-style: italic">//check if we are at the end of the iteration</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">809</span>         <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$counter</span> <span style="color: #666666">==</span> <span style="color: #666666">11</span>) {
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">810</span>             <span style="color: #408080; font-style: italic">//set the second part of the display;</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">811</span>             pushStack(<span style="color: #19177C">$sleep</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">812</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">813</span>             <span style="color: #19177C">$temp</span> <span style="color: #666666">=</span> getData(<span style="color: #BA2121">&#39;state&#39;</span>, <span style="color: #666666">0</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">814</span>             <span style="color: #408080; font-style: italic">//get the last digit of the state</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">815</span>             <span style="color: #408080; font-style: italic">//we have no variables left, so we use $sleep</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">816</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">817</span>             <span style="color: #19177C">$sleep</span> <span style="color: #666666">=</span> <span style="color: #19177C">$temp</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">818</span>             mod(<span style="color: #666666">10</span>, <span style="color: #19177C">$sleep</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">819</span>             <span style="color: #19177C">$temp</span> <span style="color: #666666">-=</span> <span style="color: #19177C">$sleep</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">820</span>             <span style="color: #19177C">$temp</span> <span style="color: #666666">/=</span> <span style="color: #666666">10</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">821</span>             <span style="color: #408080; font-style: italic">//display the last digit</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">822</span>             display(<span style="color: #19177C">$temp</span>, <span style="color: #BA2121">&#39;display&#39;</span>, <span style="color: #666666">2</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">823</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">824</span>             pullStack(<span style="color: #19177C">$sleep</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">825</span>             <span style="color: #008000">unset</span>(<span style="color: #19177C">$temp</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">826</span>         }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">827</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">828</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">829</span>         <span style="color: #408080; font-style: italic">//set the variables for the next run</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">830</span>         <span style="color: #19177C">$engines</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">831</span>         <span style="color: #19177C">$location</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">832</span>         <span style="color: #19177C">$counter</span><span style="color: #666666">++</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">833</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">834</span>         <span style="color: #408080; font-style: italic">//and return to where we came from</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">835</span>         <span style="color: #008000; font-weight: bold">return</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">836</span>     }
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">837</span> 
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">838</span>     <span style="color: #408080; font-style: italic">//loop</span>
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">839</span>     <span style="color: #19177C">$location</span><span style="color: #666666">++</span>;
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">840</span>     branch(<span style="color: #BA2121">&#39;timerManage&#39;</span>);
<span style="background-color: #f0f0f0; padding: 0 5px 0 5px">841</span> }
</pre></div>
</body>
</html>
